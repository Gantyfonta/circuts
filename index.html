<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Redstone Simulator</title>
  <style>
    body { margin:0; background:#1e1e1e; color:white; font-family:sans-serif; }
    canvas { background:#2b2b2b; display:block; margin:auto; cursor:crosshair; }
    #toolbar {
      display:flex; gap:10px; padding:10px; background:#333;
    }
    button { padding:6px 10px; background:#444; color:white; border:none; cursor:pointer; }
    button:hover { background:#666; }
  </style>
</head>
<body>
  <div id="toolbar">
    <button onclick="setTool('wire')">Wire</button>
    <button onclick="setTool('lever')">Lever</button>
    <button onclick="setTool('torch')">Torch</button>
    <button onclick="setTool('repeater')">Repeater</button>
    <button onclick="setTool('comparator')">Comparator</button>
  </div>
  <canvas id="gameCanvas" width="800" height="600"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const gridSize = 40;
    let tool = "wire";
    const components = [];

    function setTool(t) {
      tool = t;
    }

    class Component {
      constructor(x, y, type) {
        this.x = x;
        this.y = y;
        this.type = type;
        this.on = false;
        this.rotation = 0;
      }

      toggle() {
        if (this.type === "lever") {
          this.on = !this.on;
        }
      }

      rotate() {
        if (this.type !== "lever") {
          this.rotation = (this.rotation + 90) % 360;
        }
      }

      draw() {
        ctx.save();
        ctx.translate(this.x + gridSize/2, this.y + gridSize/2);
        ctx.rotate(this.rotation * Math.PI / 180);
        ctx.translate(-gridSize/2, -gridSize/2);

        ctx.strokeStyle = "white";
        ctx.lineWidth = 2;
        ctx.strokeRect(0, 0, gridSize, gridSize);

        if (this.type === "wire") {
          ctx.fillStyle = "red";
          ctx.fillRect(10, 18, 20, 4);
        } else if (this.type === "lever") {
          ctx.fillStyle = this.on ? "lime" : "gray";
          ctx.beginPath();
          ctx.arc(20, 20, 8, 0, Math.PI*2);
          ctx.fill();
        } else if (this.type === "torch") {
          ctx.fillStyle = this.on ? "orange" : "darkred";
          ctx.fillRect(16, 5, 8, 30);
        } else if (this.type === "repeater") {
          ctx.fillStyle = "purple";
          ctx.fillRect(5, 10, 30, 20);
        } else if (this.type === "comparator") {
          ctx.fillStyle = "cyan";
          ctx.fillRect(5, 10, 30, 20);
        }

        ctx.restore();
      }
    }

    function drawGrid() {
      ctx.strokeStyle = "#444";
      for (let x = 0; x < canvas.width; x += gridSize) {
        ctx.beginPath();
        ctx.moveTo(x, 0);
        ctx.lineTo(x, canvas.height);
        ctx.stroke();
      }
      for (let y = 0; y < canvas.height; y += gridSize) {
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(canvas.width, y);
        ctx.stroke();
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawGrid();
      components.forEach(c => c.draw());
    }

    function getCell(x, y) {
      return {
        x: Math.floor(x / gridSize) * gridSize,
        y: Math.floor(y / gridSize) * gridSize
      };
    }

    canvas.addEventListener("click", e => {
      const rect = canvas.getBoundingClientRect();
      const {x, y} = getCell(e.clientX - rect.left, e.clientY - rect.top);

      if (tool) {
        components.push(new Component(x, y, tool));
        draw();
      }
    });

    canvas.addEventListener("contextmenu", e => {
      e.preventDefault();
      const rect = canvas.getBoundingClientRect();
      const {x, y} = getCell(e.clientX - rect.left, e.clientY - rect.top);
      const index = components.findIndex(c => c.x === x && c.y === y);
      if (index !== -1) {
        components.splice(index, 1);
        draw();
      }
    });

    canvas.addEventListener("dblclick", e => {
      const rect = canvas.getBoundingClientRect();
      const {x, y} = getCell(e.clientX - rect.left, e.clientY - rect.top);
      const comp = components.find(c => c.x === x && c.y === y);
      if (comp) {
        if (comp.type === "lever") {
          comp.toggle();
        } else {
          comp.rotate();
        }
        draw();
      }
    });

    draw();
  </script>
</body>
</html>
